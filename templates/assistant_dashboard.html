{% load static %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Assistant Dashboard â€” AutoWave</title>
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/responsive.css' %}">
<script src="https://unpkg.com/htmx.org@1.10.0"></script>
</head>
<body hx-get="." hx-trigger="every 12s" hx-swap="outerHTML">
<header class="topbar">
  <div class="container topbar-inner" style="display:flex;align-items:center;justify-content:space-between;">
    <div class="logo" style="font-weight:700;color:#5ef0c6">AutoWave â€” Assistant</div>
    <div style="display:flex;gap:1rem;align-items:center;">
      <a href="{% url 'home' %}" class="btn ghost">Home</a>
      <a href="{% url 'logout' %}" class="btn ghost">Logout</a>
    </div>
  </div>
</header>
<main class="container" style="padding:1rem;margin-top:1rem;">

  <!-- Assistant Manager Profile Card -->
  <div style="display:flex;align-items:center;justify-content:center;margin-bottom:2rem;">
    <div class="profile-card">
      <div style="display:flex;align-items:center;gap:1rem;">
        {% if assistant_user.image %}
          <img src="{{ assistant_user.image.url }}" alt="Profile" class="assistant-profile-photo-small">
        {% else %}
          <div class="assistant-profile-photo-small-placeholder">ðŸ‘¤</div>
        {% endif %}
        <div>
          <div style="font-size:1.2rem;font-weight:700;color:#fff;">{{ assistant_user.get_full_name|default:assistant_user.username }}</div>
          <div style="font-size:0.9rem;color:#e6eef8;margin-top:0.2rem;">Assistant Manager</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Styles moved to css/home.css -->

  <h2 style="margin-bottom:1.2rem;">Booking Requests</h2>
  <div style="display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:2rem;">
    <a href="#rent" class="btn ghost">Rent Requests</a>
    <a href="#buy" class="btn ghost">Buy Requests</a>
    <a href="#cancel" class="btn ghost">Cancel Requests</a>
  </div>

  <section id="rent" style="margin-top:1.5rem;">
    <h3>Rent Requests</h3>
    {% for b in rent_requests %}
      <div class="card glass" style="padding:1.2rem 1.5rem;margin-top:1.1rem;border-left: 4px solid #f59e0b;box-shadow:0 2px 12px rgba(59,130,246,0.08);">
        <div style="display:flex;flex-wrap:wrap;gap:1.5rem;align-items:center;">
          <div style="flex:1;min-width:220px;">
            <div style="display:flex;align-items:center;gap:0.5rem;">
              {% if b.client_photo %}
                <img src="{{ b.client_photo.url }}" alt="Client Photo" class="booking-client-photo" style="width:24px !important;height:24px !important;border-radius:3px !important;object-fit:cover;">
              {% else %}
                <div style="width:24px;height:24px;border-radius:3px;background:#eee;display:flex;align-items:center;justify-content:center;font-size:0.8rem;color:#3b82f6;">ðŸ‘¤</div>
              {% endif %}
              <div>
                <strong style="font-size:1.1rem;color:#22c55e;">#{{ b.id }}</strong> â€” <span style="font-weight:600;">{{ b.full_name }}</span>
                <div style="font-size:0.95rem;color:#3b82f6;">Mobile: {{ b.mobile }}</div>
              </div>
            </div>
            <div style="margin-top:0.5rem;font-size:0.95rem;color:#555;">
              <span>Car: <b>{{ b.car }}</b></span> | <span>Type: <b>{{ b.get_request_type_display }}</b></span> | <span>Status: <b style="color:#f59e0b;">{{ b.get_status_display }}</b></span>
            </div>
            <div style="margin-top:0.5rem;font-size:0.95rem;color:#555;">
              <span>Location: <b>{{ b.location }}</b></span> | <span>ID: <b>{{ b.id_number }}</b></span>
            </div>
            <div style="margin-top:0.5rem;font-size:0.95rem;color:#555;">
              <span>License: <b>{{ b.driving_license_number }}</b></span>
              {% if b.driving_license_photo %}
                | <a href="{{ b.driving_license_photo.url }}" target="_blank" style="color:#3b82f6;text-decoration:underline;">View License Photo</a>
              {% endif %}
            </div>
            <div style="margin-top:0.5rem;font-size:0.95rem;color:#555;">
              <span>Created: <b>{{ b.created_at|date:"M d, Y H:i" }}</b></span>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:0.7rem;min-width:120px;align-items:flex-end;">
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="confirm">
              <button class="btn primary" type="submit">Confirm</button>
            </form>
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="reject">
              <button class="btn ghost" type="submit">Reject</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No rent requests</p>
    {% endfor %}
  </section>

  <section id="buy" style="margin-top:1.5rem;">
    <h3>Buy Requests</h3>
    {% for b in buy_requests %}
      <div class="card" style="padding:0.8rem;margin-top:0.6rem;border-left: 4px solid #f59e0b;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;">
          <div style="flex:1;min-width:200px;">
            <strong>#{{ b.id }}</strong> â€” {{ b.full_name }} ({{ b.mobile }})
            <div style="font-size:0.9rem;color:var(--muted);">Car: {{ b.car }} â€” Status: <span style="color:#f59e0b;font-weight:600;">{{ b.get_status_display }}</span></div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="confirm">
              <button class="btn primary" type="submit">Confirm</button>
            </form>
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="reject">
              <button class="btn ghost" type="submit">Reject</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No buy requests</p>
    {% endfor %}
  </section>

  <section id="cancel" style="margin-top:1.5rem;">
    <h3>Cancellation Requests</h3>
    {% for b in cancel_requests %}
      <div class="card" style="padding:0.8rem;margin-top:0.6rem;border-left: 4px solid #ef4444;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;">
          <div style="flex:1;min-width:200px;">
            <strong>#{{ b.id }}</strong> â€” {{ b.full_name }} ({{ b.mobile }})
            <div style="font-size:0.9rem;color:var(--muted);">Car: {{ b.car }} â€” Status: <span style="color:#ef4444;font-weight:600;">{{ b.get_status_display }}</span></div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <form method="post" action="{% url 'cancel_booking_confirmed' b.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn primary" type="submit" style="background:#ef4444;">Approve Cancel</button>
            </form>
            <form method="post" action="{% url 'deny_cancellation' b.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn ghost" type="submit">Deny Cancel</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No cancellation requests</p>
    {% endfor %}
  </section>

  <section id="confirmed" style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,0.1);">
    <h3 style="color:#22c55e;">Confirmed Bookings (Ready for Delivery)</h3>
    <p style="color:rgba(230,238,248,0.6);font-size:0.9rem;">Click "Mark Complete" when delivery is finished.</p>
    {% for b in confirmed_bookings %}
      <div class="card" style="padding:0.8rem;margin-top:0.6rem;border-left: 4px solid #22c55e;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;">
          <div style="flex:1;min-width:200px;">
            <strong>#{{ b.id }}</strong> â€” {{ b.full_name }} ({{ b.mobile }})
            <div style="font-size:0.9rem;color:var(--muted);">Car: {{ b.car }} â€” Status: <span style="color:#22c55e;font-weight:600;">{{ b.get_status_display }}</span></div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <form method="post" action="{% url 'mark_delivery_complete' b.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn primary" type="submit" style="background:#22c55e;">âœ“ Mark Complete</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p style="color:rgba(230,238,248,0.4);">No confirmed bookings awaiting delivery.</p>
    {% endfor %}
  </section>

</main>
</body>
</html>
