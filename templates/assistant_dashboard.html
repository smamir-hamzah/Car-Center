{% load static %}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Assistant Dashboard — AutoWave</title>
<link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>
<body>
<header class="topbar">
  <div class="container topbar-inner" style="display:flex;align-items:center;justify-content:space-between;">
    <div class="logo" style="font-weight:700;color:#5ef0c6">AutoWave — Assistant</div>
    <div style="display:flex;gap:1rem;align-items:center;">
      <a href="{% url 'home' %}" class="btn ghost">Home</a>
      <a href="{% url 'logout' %}" class="btn ghost">Logout</a>
    </div>
  </div>
</header>
<main class="container" style="padding:1rem;margin-top:1rem;">
  <h2>Assistant — Booking Requests</h2>
  <div style="display:flex;gap:1rem;flex-wrap:wrap;margin-top:1rem;">
    <a href="#rent" class="btn ghost">Rent Requests</a>
    <a href="#buy" class="btn ghost">Buy Requests</a>
    <a href="#cancel" class="btn ghost">Cancel Requests</a>
  </div>

  <section id="rent" style="margin-top:1.5rem;">
    <h3>Rent Requests</h3>
    {% for b in rent_requests %}
      <div class="card" style="padding:0.8rem;margin-top:0.6rem;border-left: 4px solid #f59e0b;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;">
          <div style="flex:1;min-width:200px;">
            <strong>#{{ b.id }}</strong> — {{ b.full_name }} ({{ b.mobile }})
            <div style="font-size:0.9rem;color:var(--muted);">Car: {{ b.car }} — Status: <span style="color:#f59e0b;font-weight:600;">{{ b.get_status_display }}</span></div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="confirm">
              <button class="btn primary" type="submit">Confirm</button>
            </form>
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="reject">
              <button class="btn ghost" type="submit">Reject</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No rent requests</p>
    {% endfor %}
  </section>

  <section id="buy" style="margin-top:1.5rem;">
    <h3>Buy Requests</h3>
    {% for b in buy_requests %}
      <div class="card" style="padding:0.8rem;margin-top:0.6rem;border-left: 4px solid #f59e0b;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;">
          <div style="flex:1;min-width:200px;">
            <strong>#{{ b.id }}</strong> — {{ b.full_name }} ({{ b.mobile }})
            <div style="font-size:0.9rem;color:var(--muted);">Car: {{ b.car }} — Status: <span style="color:#f59e0b;font-weight:600;">{{ b.get_status_display }}</span></div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="confirm">
              <button class="btn primary" type="submit">Confirm</button>
            </form>
            <form method="post" action="{% url 'assistant_process_booking' b.id %}">
              {% csrf_token %}
              <input type="hidden" name="action" value="reject">
              <button class="btn ghost" type="submit">Reject</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No buy requests</p>
    {% endfor %}
  </section>

  <section id="cancel" style="margin-top:1.5rem;">
    <h3>Cancellation Requests</h3>
    {% for b in cancel_requests %}
      <div class="card" style="padding:0.8rem;margin-top:0.6rem;border-left: 4px solid #ef4444;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;">
          <div style="flex:1;min-width:200px;">
            <strong>#{{ b.id }}</strong> — {{ b.full_name }} ({{ b.mobile }})
            <div style="font-size:0.9rem;color:var(--muted);">Car: {{ b.car }} — Status: <span style="color:#ef4444;font-weight:600;">{{ b.get_status_display }}</span></div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <form method="post" action="{% url 'cancel_booking_confirmed' b.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn primary" type="submit" style="background:#ef4444;">Approve Cancel</button>
            </form>
            <form method="post" action="{% url 'deny_cancellation' b.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn ghost" type="submit">Deny Cancel</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p>No cancellation requests</p>
    {% endfor %}
  </section>

  <section id="confirmed" style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,0.1);">
    <h3 style="color:#22c55e;">Confirmed Bookings (Ready for Delivery)</h3>
    <p style="color:rgba(230,238,248,0.6);font-size:0.9rem;">Click "Mark Complete" when delivery is finished.</p>
    {% for b in confirmed_bookings %}
      <div class="card" style="padding:0.8rem;margin-top:0.6rem;border-left: 4px solid #22c55e;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.8rem;">
          <div style="flex:1;min-width:200px;">
            <strong>#{{ b.id }}</strong> — {{ b.full_name }} ({{ b.mobile }})
            <div style="font-size:0.9rem;color:var(--muted);">Car: {{ b.car }} — Status: <span style="color:#22c55e;font-weight:600;">{{ b.get_status_display }}</span></div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <form method="post" action="{% url 'mark_delivery_complete' b.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn primary" type="submit" style="background:#22c55e;">✓ Mark Complete</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <p style="color:rgba(230,238,248,0.4);">No confirmed bookings awaiting delivery.</p>
    {% endfor %}
  </section>

</main>
</body>
</html>
