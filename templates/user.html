{% load static %}
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>AutoWave — Rent & Buy</title>

	<link rel="stylesheet" href="{% static 'css/home.css' %}">
	<script src="https://unpkg.com/htmx.org@1.10.0"></script>
</head>
<body hx-get="." hx-trigger="every 12s" hx-swap="outerHTML">


	<header class="topbar">
		<div class="container topbar-inner" style="display:flex;align-items:center;justify-content:space-between;">
			<div class="logo" style="font-weight:700;font-size:1.25rem;color:#5ef0c6">AutoWave</div>

			<nav class="main-nav" style="display:flex;gap:1rem;">
				<a href="#home">Home</a>
				<a href="#about">About Us</a>
				<a href="#contact">Contact Us</a>
				<a href="#location">Location</a>
				<a href="#cars">Cars</a>
				<a href="#process">How It Works</a>
				<a href="#reviews">Reviews</a>

				
			</nav>

			<div class="auth">
              <a href="{% url 'logout' %}" class="btn ghost">Logout</a>
			</div>
		</div>
	</header>


	<main id="home">


<section class="hero-banner">
    <div class="hero-content">
        <h1>About AutoWave</h1>
        <p>
            AutoWave offers premium cars for rent and sale with flexible plans, 
            transparent pricing, and modern features. Drive with confidence.
        </p>
        <button class="btn primary">Learn More</button>
    </div>
</section>

<section id="cars" class="cars container">
    <h2>Available for Rent</h2>
    <div class="grid" id="rentCars" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1rem;">
		{% for car in rentCars %}
		<div class="card glass reveal" data-direction="left" data-id="{{ car.id }}">
            <div class="card-media" style="height:160px;overflow:hidden;">
                {% if car.photo %}
                <img class="card-main" src="{{ car.photo.url }}" alt="{{ car.model }}" style="width:100%;height:100%;object-fit:cover;">
                {% else %}
                <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#111;color:#ddd">No image</div>
                {% endif %}
            </div>
            <div class="card-body" style="padding:1rem">
                <h3>{{ car.model }}</h3>
                <p class="price">{{ car.price_display }}</p>

				{% if focus_car_id and car.id == focus_car_id %}
					{# If focused, show only the relevant action for thisu car type #}
					{% if car.car_type == 'rent' %}
						<button class="btn primary rent-btn" data-id="{{ car.id }}">Rent</button>
					{% else %}
						<button class="btn primary buy-btn" data-id="{{ car.id }}">Buy</button>
					{% endif %}
				{% else %}
					<!-- Updated Details button -->
					<a class="btn ghost" href="{% url 'usercar_detail' car.id %}">Details</a>
					<button class="btn primary rent-btn" data-id="{{ car.id }}">Rent</button>
				{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <h2 style="margin-top:2.25rem;">Cars for Sale</h2>
    <div class="grid" id="saleCars" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1rem;">
        {% for car in saleCars %}
        <div class="card glass reveal" data-direction="right" data-id="{{ car.id }}">
            <div class="card-media" style="height:160px;overflow:hidden;">
                {% if car.photo %}
                <img class="card-main" src="{{ car.photo.url }}" alt="{{ car.model }}" style="width:100%;height:100%;object-fit:cover;">
                {% else %}
                <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#111;color:#ddd">No image</div>
                {% endif %}
            </div>
            <div class="card-body" style="padding:1rem">
                <h3>{{ car.model }}</h3>
                <p class="price">{{ car.price_display }}</p>

				{% if focus_car_id and car.id == focus_car_id %}
					{% if car.car_type == 'rent' %}
						<button class="btn primary rent-btn" data-id="{{ car.id }}">Rent</button>
					{% else %}
						<button class="btn primary buy-btn" data-id="{{ car.id }}">Buy</button>
					{% endif %}
				{% else %}
					<!-- Updated Details button -->
					<a class="btn ghost" href="{% url 'usercar_detail' car.id %}">Details</a>
					<button class="btn primary buy-btn" data-id="{{ car.id }}">Buy</button>
				{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>


		<section id="location" class="map-section glass container reveal" data-direction="right">
			<h2>Our Office Location</h2>
			<div class="map-wrap" style="height:320px;overflow:hidden">
				<iframe
					src="https://www.google.com/maps?q=37.7749,-122.4194&z=15&output=embed"
					style="border:0;width:100%;height:100%;" allowfullscreen="" loading="lazy"></iframe>
			</div>
			<p style="margin-top:.6rem;color:var(--muted);font-size:.95rem">
				<a href="https://maps.app.goo.gl/8KDWcveHf6M1BXHp9" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:none">Open in Google Maps</a>
			</p>
		</section>

		<section id="process" class="container glass reveal" data-direction="right">
			<h2>How Our Service Works</h2>
			<div class="process-steps" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;margin-top:1rem">
				<div class="step glass"><h3>1. Login / Create Account</h3><p>Use your email to login or register.</p></div>
				<div class="step glass"><h3>2. Choose Your Car</h3><p>Select rent or buy from our modern fleet.</p></div>
				<div class="step glass"><h3>3. Submit the Form</h3><p>Fill your booking or purchase information.</p></div>
				<div class="step glass"><h3>4. Get Confirmation</h3><p>A confirmation will appear shortly in your account.</p></div>
				<div class="step glass"><h3>5. Visit Our Location</h3><p>Come to our office and pick up / inspect the car.</p></div>
			</div>
		</section>

		<section id="reviews" class="container glass reveal" data-direction="left">
			<h2>What Our Customers Say</h2>
			<div class="reviews-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-top:1rem;">
				{% for r in reviews %}
				<div class="review-card glass" style="padding:1rem;">
					<p class="review-text">“{{ r.text }}”</p>
					<p class="review-user">— {{ r.name }}, ★{{ r.rating }}</p>
				</div>
				{% endfor %}
			</div>
		</section>

		<section id="about" class="container about glass reveal" data-direction="right">
			<h2>About Us</h2>
			<p>
				AutoWave blends premium vehicles, flexible rentals and transparent buying. We curate a modern fleet — from efficient city cars and sporty coupes to family vans and electric models — all inspected and maintained to high standards.
			</p>
			<p>
				Our mission is simple: make mobility effortless. Rent by the day, week, or month with transparent pricing and comprehensive support, or buy with confidence through our certified pre-owned checks and financing guidance. We offer airport pickup, long-term corporate leasing, and dedicated customer care.
			</p>
		</section>

		<section id="contact" class="container contact glass reveal" data-direction="left">
			<h2>Contact Us</h2>
			<p>Email: hello@autowave.example • Phone: (555) 123-4567</p>
		</section>

	</main>

	<!-- My Bookings Section -->
<section id="my-bookings" class="container" style="margin-top:2rem;margin-bottom:2rem;">
	<h2>My Bookings</h2>
	{% if my_bookings %}
		<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem;margin-top:1rem;">
			{% for booking in my_bookings %}
				<div class="card" style="padding:1rem;border: 1px solid rgba(255,255,255,0.06);">
					<div style="margin-bottom:1rem;">
						<h4 style="color:#5ef0c6;margin:0 0 0.5rem 0;">
							{% if booking.car %}
								{{ booking.car.model }}
							{% else %}
								Booking #{{ booking.id }}
							{% endif %}
						</h4>
						<p style="color:rgba(230,238,248,0.7);font-size:0.9rem;margin:0;">
							<strong>ID:</strong> #{{ booking.id }}<br>
							<strong>Type:</strong> {{ booking.get_request_type_display }}<br>
							<strong>Status:</strong> 
							<span class="booking-status {% if booking.status == 'confirmed' %}confirmed{% elif booking.status == 'completed' %}completed{% elif booking.status == 'rejected' %}rejected{% elif booking.status == 'cancelled' %}cancelled{% elif booking.status == 'cancel_requested' %}cancel-requested{% else %}pending{% endif %}">
								{{ booking.get_status_display }}
							</span>
							{% if booking.status == 'completed' %}<br><strong style="color:#3b82f6;">✓ Delivery is Complete</strong>{% endif %}
							{% if booking.status == 'cancelled' %}<br><strong style="color:#ef4444;">✗ Booking Cancelled</strong>{% endif %}
							{% if booking.status == 'rejected' %}<br><strong style="color:#ef4444;">✗ Booking Rejected</strong>{% endif %}
							<br>
							<strong>Created:</strong> {{ booking.created_at|date:"M d, Y H:i" }}
						</p>
					</div>

					<!-- Show Cancel button only for confirmed bookings (not pending, not already cancelled/rejected) -->
					{% if booking.status == 'confirmed' %}
						<form method="post" action="{% url 'booking_cancel_request' booking.id %}" style="display:inline;">
							{% csrf_token %}
							<button class="btn ghost" type="submit" style="width:100%;">Request Cancellation</button>
						</form>
						<p style="font-size:0.85rem;color:rgba(230,238,248,0.6);margin-top:0.5rem;">
							If you need to cancel, our members will review your request.
						</p>
					{% else %}
						<!-- Disabled for pending/cancelled/completed/rejected bookings -->
						<button class="btn ghost" disabled style="width:100%;opacity:0.5;cursor:not-allowed;">
							{% if booking.status == 'pending' %}Pending Review{% elif booking.status == 'cancel_requested' %}Cancellation Pending{% else %}No Actions Available{% endif %}
						</button>
						<p style="font-size:0.85rem;color:rgba(230,238,248,0.4);margin-top:0.5rem;">
							{% if booking.status == 'pending' %}Waiting for staff to review your booking.{% elif booking.status == 'cancel_requested' %}Your cancellation request is under review.{% else %}This booking cannot be modified.{% endif %}
						</p>
					{% endif %}
				</div>
			{% endfor %}
		</div>
	{% else %}
		<p style="color:rgba(230,238,248,0.6);margin-top:1rem;">You have no bookings yet. <a href="#cars" style="color:#5ef0c6;">Browse cars</a> to get started.</p>
	{% endif %}
</section>

	<footer class="footer">
		<div class="container">© AutoWave — Smooth rides, clear deals.</div>
	</footer>




	<!-- Booking Modal -->
	<div id="bookingOverlay" class="modal-overlay hidden">
		<div class="modal" id="bookingModal">
			<button class="modal-close" id="bookingClose">&times;</button>
			<div class="modal-content">
				<form id="bookingForm" class="auth-form" method="post" action="{% url 'book' %}" enctype="multipart/form-data">
					{% csrf_token %}
					<h3 style="color:#e6eef8">Book this Car</h3>
					<input type="hidden" name="car_id" value="">
					<input type="hidden" name="request_type" value="rent">
					<label>Full Name</label>
					<input type="text" name="full_name" required>
					<label>Mobile Number</label>
					<input type="text" name="mobile" required>
					<label class="rent-only">Start Date</label>
					<input class="rent-only" type="date" name="start_date">
					<label class="rent-only">End Date</label>
					<input class="rent-only" type="date" name="end_date">
					<label class="rent-only">Location</label>
					<input class="rent-only" type="text" name="location" required>
					<label class="rent-only">NID / Passport Number</label>
					<input class="rent-only" type="text" name="id_number" required>
					<label class="rent-only">Driving License Number</label>
					<input class="rent-only" type="text" name="driving_license_number">
					<label class="rent-only">Driving License Photo</label>
					<input class="rent-only" type="file" name="driving_license_photo" accept="image/*">
					<label>Your Photo</label>
					<input type="file" name="client_photo" accept="image/*">
					<div style="margin-top:1rem;display:flex;gap:.5rem;justify-content:flex-end;">
						<button type="button" class="btn ghost" id="bookingCancel">Cancel</button>
						<button type="submit" class="btn primary">Submit Booking</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Buy Booking Modal (Separate for Cars for Sale) -->
	<div id="buyBookingOverlay" class="modal-overlay hidden">
		<div class="modal" id="buyBookingModal">
			<button class="modal-close" id="buyBookingClose">&times;</button>
			<div class="modal-content">
				<form id="buyBookingForm" class="auth-form" method="post" action="{% url 'book' %}" enctype="multipart/form-data">
					{% csrf_token %}
					<h3 style="color:#e6eef8">Purchase this Car</h3>
					<input type="hidden" name="car_id" value="">
					<input type="hidden" name="request_type" value="buy">
					<label>Full Name</label>
					<input type="text" name="full_name" required>
					<label>Mobile Number</label>
					<input type="text" name="mobile" required>
					<label>Your Photo</label>
					<input type="file" name="client_photo" accept="image/*">
					<div style="margin-top:1rem;display:flex;gap:.5rem;justify-content:flex-end;">
						<button type="button" class="btn ghost" id="buyBookingCancel">Cancel</button>
						<button type="submit" class="btn primary">Submit Purchase Request</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	

	<script src="{% static 'js/home.js' %}"></script>
</body>
</html>